<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirmación de Pago - Deja Tu Huella</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/pago.css}">
</head>
<body>
    <!-- Navbar -->
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <div class="container mt-5 mb-5">
        <div class="row">
            <div class="col-md-12">
                <div class="confirmation-container">
                    <!-- Encabezado de confirmación -->
                    <div class="confirmation-header">
                        <div class="text-center">
                            <i class="fas fa-check-circle confirmation-icon"></i>
                            <h2>¡Pago Realizado con Éxito!</h2>
                            <p>Tu pedido ha sido procesado y confirmado</p>
                            <div class="mt-3 thank-you-message">
                                <h4>¡Gracias por tu compra!</h4>
                                <p>Apreciamos tu confianza en Deja Tu Huella. Tu apoyo nos ayuda a seguir creciendo.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Detalles de la confirmación -->
                    <div class="confirmation-details">
                        <div class="row">
                            <div class="col-md-6">
                                <h4>Detalles del Pedido</h4>
                                <p><strong>Número de Pedido:</strong> <span th:text="${pedido.id}"></span></p>
                                <p><strong>Fecha:</strong> <span th:text="${#temporals.format(pedido.fechaPedido, 'dd/MM/yyyy HH:mm')}"></span></p>
                                <p><strong>Estado:</strong> 
                                    <span class="status-badge status-pagado" th:text="${pedido.estado.nombreEstado}"></span>
                                </p>
                            </div>
                            <div class="col-md-6">
                                <h4>Resumen de Pago</h4>
                                <p><strong>Total Pagado:</strong> <span th:text="'S/ ' + ${pedido.total}"></span></p>
                                <p><strong>Método de Pago:</strong> Tarjeta de Crédito/Débito</p>
                                <p><strong>Fecha de Pago:</strong> <span th:text="${#temporals.format(#temporals.createNow(), 'dd/MM/yyyy HH:mm')}"></span></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Resumen de productos -->
                    <div class="order-summary">
                        <h4>Productos Adquiridos</h4>
                        <div class="product-list">
                            <div class="product-item" th:each="detalle : ${pedido.detalles}">
                                <div class="row">
                                    <div class="col-md-8">
                                        <p class="mb-0">
                                            <span th:text="${detalle.producto.nombre}"></span>
                                            <span class="text-muted">x</span>
                                            <span th:text="${detalle.cantidad}"></span>
                                        </p>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <p class="mb-0" th:text="'S/ ' + ${detalle.precio * detalle.cantidad}"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-8 text-end">
                                <p class="mb-0"><strong>Total:</strong></p>
                            </div>
                            <div class="col-md-4 text-end">
                                <p class="mb-0"><strong th:text="'S/ ' + ${pedido.total}"></strong></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Instrucciones adicionales -->
                    <div class="alert alert-info" role="alert">
                        <i class="fas fa-info-circle"></i> Hemos enviado un correo electrónico con los detalles de tu compra. 
                        El vendedor procesará tu pedido pronto y te notificará cuando sea enviado.
                    </div>
                    
                    <!-- Botones de acción -->
                    <div class="text-center mt-4">
                        <a th:href="@{/mis-compras}" class="btn btn-continue me-2">
                            <i class="fas fa-shopping-bag"></i> Ver Mis Compras
                        </a>
                        <a th:href="@{/}" class="btn btn-outline-secondary me-2">
                            <i class="fas fa-home"></i> Volver al Inicio
                        </a>
                        <!-- Botón para cancelar pedido (solo si está pagado) -->
                        <form th:if="${pedido.estado.nombreEstado == 'PAGADO'}" th:action="@{'/api/pedidos/' + ${pedido.id} + '/cancelar'}" method="post" class="d-inline" id="formCancelarPedido">
                            <button type="button" class="btn btn-danger" onclick="confirmarCancelacion()">
                                <i class="fas fa-times-circle"></i> Cancelar Pedido
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div th:replace="~{fragments/footer :: footer}"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/pago.js}"></script>
    <script>
        function confirmarCancelacion() {
            if (confirm('¿Estás seguro de que deseas cancelar este pedido? Esta acción no se puede deshacer.')) {
                document.getElementById('formCancelarPedido').submit();
            }
        }
    </script>
</body>
</html>